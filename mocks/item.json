{"id":14768694,"title":"Redis on the Raspberry Pi: Adventures in unaligned lands","points":105,"user":"bjerun","time":1500026548,"time_ago":"5 hours ago","type":"link","url":"http://antirez.com/news/111","domain":"antirez.com","comments":[{"id":14769460,"level":0,"user":"drej","time":1500037568,"time_ago":"2 hours ago","content":"<p>I never deal with such low level issues, so I don&#x27;t have to read this, but... reading these posts by antirez is such a joy. He makes this topic so clear and understandable, he doesn&#x27;t assume much, he doesn&#x27;t use overly complex explanations, he just &quot;says it like it is&quot; :-)<p>Thanks!","comments":[{"id":14769952,"level":1,"user":"hellwd","time":1500041816,"time_ago":"33 minutes ago","content":"<p>++ :)","comments":[]}]},{"id":14769019,"level":0,"user":"blattimwind","time":1500032433,"time_ago":"3 hours ago","content":"<p>There is a funny mode on ARM processors (turned on in some images, by default) which causes unaligned reads to silently return bogus data (just increasing a kernel counter).<p>PowerPC, and really, most non-x86 architectures, do this one way or another.","comments":[{"id":14769797,"level":1,"user":"faragon","time":1500040685,"time_ago":"an hour ago","content":"<p>PowerPC (and POWER) has reasonable hardware support for unaligned memory access, at least for 32-bit data, and if the data is in the data cache. Depending on the processor, the exceptions that reach the OS can be more or less frequent.<p>ARM v6-A and later (except for some microcontrollers, like Cortex M0&#x2F;R0, that don&#x27;t support hardware unaligned access at all, triggering a exception) is similar to the Intel x86 case (reference in transparent unaligned memory access -except for SIMD, where x86 can raise exceptions, too, in the case of unaligned load&#x2F;store opcodes-), where there is hardware support for unaligned memory access.<p>For software that uses intensive non-aligned data access, e.g. data compression algorithms doing string search, PowerPC, ARM v6-A (and later ARM Application processors), new MIPS with HW support for unaligned memory access, and Intel are pretty much the same (i.e. b = * (uint32_t * )(a + 23) will take 1-2 cycles, not requiring doing a memcpy(&amp;b, a + 23, sizeof(uint32_t))).<p>For SIMD, though, there is no transparent fix, although there are specific opcodes for aligned and unaligned memory access (e.g. load&#x2F;store, unaligned load&#x2F;store).","comments":[{"id":14770024,"level":2,"user":"antirez","time":1500042410,"time_ago":"23 minutes ago","content":"<p>I would say that ARM v6 and later is a major step forward, but is v8 that really seems to be similar to Intel finally. The v6 was able to deal only with single fetch&#x2F;store unaligned instructions, but things like accessing a double or  multiple words with the same instruction would raise an exception.","comments":[]}]}]},{"id":14769239,"level":0,"user":"drewg123","time":1500035560,"time_ago":"2 hours ago","content":"<p>I fondly remember unaligned access faults &quot;back in the day&quot; with FreeBSD&#x2F;alpha.  We implemented a fixup for applications, but not for the kernel.   I seem to recall that even though x86 could deal with unaligned accesses, it caused minor performance problems, so fixing alignment issues on alpha would benefit x86 as well.<p>Most (definitely not all) of the mis-alignment problems were in the network stack, and were centered around the fact that ethernet headers are 14 bytes, while nearly all other protocols had headers that were a multiple of at least 4 bytes.<p>I&#x27;ve said it before, and I&#x27;ll say it again:  If I had a time machine, I would not kill Hitler.  I&#x27;d go back to the 70s and make the ethernet header be 16 bytes long, rather than 14.","comments":[{"id":14769356,"level":1,"user":"IgorPartola","time":1500036595,"time_ago":"2 hours ago","content":"<p>Why in god&#x27;s name did they make it 14?!","comments":[{"id":14769486,"level":2,"user":"pjc50","time":1500037864,"time_ago":"2 hours ago","content":"<p>Ethernet was invented in 1973 and the first 32-bit processors were available in 1979.<p>While you&#x27;ve got the time machine, can you fix it so that &quot;network byte order&quot; and Intel endianness are the same too?","comments":[{"id":14769667,"level":3,"user":"drewg123","time":1500039500,"time_ago":"an hour ago","content":"<p>The 32-bit Vax 11&#x2F;780 was introduced in 1977 and IEEE 802.3 was not finalized until 1983.   So they could&#x2F;should have done something about it I think.<p>Come to think of it, the Vax was little endian (like Intel).","comments":[]},{"id":14769557,"level":3,"user":"swiley","time":1500038620,"time_ago":"an hour ago","content":"<p>Or rather keep Intel from munging the order their processors write bytes in.","comments":[]}]},{"id":14769446,"level":2,"user":"jimktrains2","time":1500037441,"time_ago":"2 hours ago","content":"<p>They didn&#x27;t feel like they needed those 2 bytes and, hey, why waste space?<p>Also, was a &quot;byte&quot; standardized at the time? Didn&#x27;t they still have systems working in not-8-bit &quot;byte&quot;, nibbles, byte, and 2-byte boundaries?","comments":[{"id":14769714,"level":3,"user":"danesparza","time":1500039894,"time_ago":"an hour ago","content":"<p>From <a href=\"https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Byte#History\" rel=\"nofollow\">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Byte#History</a> - a byte was in the process of getting standardized at around the same time.","comments":[]}]}]}]},{"id":14769686,"level":0,"user":"MrBuddyCasino","time":1500039671,"time_ago":"an hour ago","content":"<p>Accessing memory locations ending in 0x7? \nGather round the campfire folks, James Mickens has a story to tell: \n<a href=\"https:&#x2F;&#x2F;www.usenix.org&#x2F;system&#x2F;files&#x2F;1311_05-08_mickens.pdf\" rel=\"nofollow\">https:&#x2F;&#x2F;www.usenix.org&#x2F;system&#x2F;files&#x2F;1311_05-08_mickens.pdf</a>","comments":[]},{"id":14769617,"level":0,"user":"type0","time":1500039184,"time_ago":"an hour ago","content":"<p>Great article, this project just begs the name of <i>Redisberry Pi</i>","comments":[]},{"id":14769386,"level":0,"user":"amelius","time":1500036865,"time_ago":"2 hours ago","content":"<p>Could Rust&#x27;s typesystem catch unaligned pointer dereferences?","comments":[{"id":14769409,"level":1,"user":"wofo","time":1500037021,"time_ago":"2 hours ago","content":"<p>Considering dereferencing a pointer after doing some arithmetic on it can only be done within unsafe blocks, I would say you are at least warned about it. But it will happily compile.","comments":[]}]},{"id":14769768,"level":0,"user":"crncosta","time":1500040448,"time_ago":"an hour ago","content":"<p>Nice article!","comments":[]},{"id":14769050,"level":0,"user":"k__","time":1500032752,"time_ago":"3 hours ago","content":"<p>OT: Is blattimwind shadow banned?","comments":[{"id":14769099,"level":1,"user":"make3","time":1500033347,"time_ago":"3 hours ago","content":"<p>? I see his post","comments":[{"id":14769143,"level":2,"user":"yorwba","time":1500034198,"time_ago":"3 hours ago","content":"<p>Probably someone vouched for it.","comments":[]}]},{"id":14769127,"level":1,"user":"retox","time":1500033934,"time_ago":"3 hours ago","content":"<p>No, but posting while green will usually get your comment downvoted to oblivion, even if you are erudite and contribute to the conversation.<p>Turn on &quot;show dead comments&quot; and see how many greens are deleted. I screenshot many examples.","comments":[{"id":14769145,"level":2,"user":"taneq","time":1500034204,"time_ago":"3 hours ago","content":"<p>Is this cause (ie. people downvote greens out of prejudice) or effect (greens are often created to shitpost?<p>And to concentrate all my meta in one place... Is shadow banning a thing at HN? I thought they just, well, banned you.","comments":[{"id":14769558,"level":3,"user":"Rjevski","time":1500038624,"time_ago":"an hour ago","content":"<p>OT - new user here, what does green mean? I assumed it was staff&#x2F;moderators.","comments":[{"id":14769605,"level":4,"user":"mbel","time":1500039061,"time_ago":"an hour ago","content":"<p>It means new user (hence green color).","comments":[]},{"id":14769619,"level":4,"user":"parthdesai","time":1500039192,"time_ago":"an hour ago","content":"<p>your username will appear green till you get a certain amount of karma&#x2F;upvotes.","comments":[{"id":14769755,"level":5,"user":"striking","time":1500040337,"time_ago":"an hour ago","content":"<p>I thought it was based on time.","comments":[]}]}]},{"id":14769220,"level":3,"user":"Jtsummers","time":1500035331,"time_ago":"2 hours ago","content":"<p>They added shadowbanning some time ago and later added a user (the rest of us) ability to vouch for dead posts to revive them. There were reasons at the time they did this that the admins could probably explain better.","comments":[]}]},{"id":14769133,"level":2,"user":"icebraining","time":1500034017,"time_ago":"3 hours ago","content":"<p>I doubt it&#x27;s downvotes. Probably cases of the spam&#x2F;ringvoting detector gone wrong.","comments":[]}]}]}],"comments_count":28}